<!DOCTYPE html>
<html lang=" en ">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>
    (Deprecated)
    
  </title>

  <meta name="description" content="Distributed Linear Algebra">

  <link rel="stylesheet" href="/assets/css/main.css">

  <!-- Font Awesome -->
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Maven+Pro:400,500" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Muli:400,400i,700,700i" rel="stylesheet">

  <link rel="canonical" href="http://mahout.apache.org//docs/latest/algorithms/map-reduce/classification/bayesian.html">
  <link rel="alternate" type="application/rss+xml" title="Apache Mahout" href="/feed.xml">


</head>


<body>

  <nav class="navbar navbar-expand-lg navbar-light bg-light navbar-mahout">

    <div class="container">

        <a class="navbar-brand" href="/">
            <img src="/assets/mahout-logo-blue.svg" alt="">
        </a>

        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarSupportedContent">

            <div class="navbar-nav ml-auto">

                <!-- Quick Start -->
                <li class="nav-item">
                    <a class="nav-link" href="/docs/latest" >Overview</a>
                </li>

                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Key Concepts</a>
                    <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                        <a class="dropdown-item"  href="/docs/latest/index.html">Mahout Overview</a>
                        <div class="dropdown-divider"></div>
                        <h6 class="dropdown-header">Scala DSL</h6>
                        <a class="dropdown-item"  href="/docs/latest/mahout-samsara/in-core-reference.html">In-core Reference</a>
                        <a class="dropdown-item"  href="/docs/latest/mahout-samsara/out-of-core-reference.html">Out-of-core Reference</a>
                        <a class="dropdown-item"  href="/docs/latest/mahout-samsara/faq.html">Samsara FAQ</a>
                        <div class="dropdown-divider"></div>
                        <h6 class="dropdown-header">Distributed Engine Bindings</h6>
                        <a class="dropdown-item"  href="/docs/latest/distributed/spark-bindings/">Spark Bindings</a>
                        <a class="dropdown-item"  href="/docs/latest/distributed/flink-bindings.html">Flink Bindings</a>
                        <a class="dropdown-item"  href="/docs/latest/distributed/flink-bindings.html">H20 Bindings</a>
                        <!--<div class="dropdown-divider"></div>
                        <h6 class="dropdown-header">Native Solvers</h6>
                        <a class="dropdown-item"  href="/docs/latest/native-solvers/viennacl.html">ViennaCL</a></li>
                        <a class="dropdown-item"  href="/docs/latest/native-solvers/viennacl-omp.html">ViennaCL-OMP</a></li>
                        <a class="dropdown-item"  href="/docs/latest/native-solvers/cuda.html">CUDA</a></li>-->
                    </div>
                </li>

                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Tutorial</a>
                    <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                        <div class="dropdown-divider"></div>
                        <h6 class="dropdown-header">Recommenders</h6>
                        <a class="dropdown-item"  href="/docs/latest/tutorials/cco-lastfm">CCO Example with Last.FM Data</a>
                        <a class="dropdown-item"  href="/docs/latest/tutorials/intro-cooccurrence-spark">Introduction to Cooccurrence in Spark</a>
                        <div class="dropdown-divider"></div>
                        <h6 class="dropdown-header">Mahout Samsara</h6>
                        <a class="dropdown-item"  href="/docs/latest/tutorials/samsara/play-with-shell.html">Playing with Samsara in Spark Shell</a>
                        <a class="dropdown-item"  href="/docs/latest/tutorials/samsara/playing-with-samsara-flink-batch.html">Playing with Samsara in Flink Batch</a>
                        <a class="dropdown-item"  href="/docs/latest/tutorials/samsara/classify-a-doc-from-the-shell.html">Text Classification (Shell)</a>
                        <a class="dropdown-item"  href="/docs/latest/tutorials/samsara/spark-naive-bayes.html">Spark Naive Bayes</a>
                        <div class="dropdown-divider"></div>
                        <h6 class="dropdown-header">Misc</h6>
                        <a class="dropdown-item"  href="/docs/latest/tutorials/misc/getting-started-with-zeppelin">Mahout in Apache Zeppelin (Quickstart)</a>
<!--                        <a class="dropdown-item"  href="/docs/latest/tutorials/misc/mahout-in-zeppelin">Mahout in Apache Zeppelin (Roll your own)</a>-->
                        <a class="dropdown-item"  href="/docs/latest/tutorials/misc/contributing-algos">How To Contribute a New Algorithm</a>
                        <a class="dropdown-item"  href="/docs/latest/tutorials/misc/how-to-build-an-app.html">How To Build An App</a>
                        <div class="dropdown-divider"></div>
                        <h6 class="dropdown-header">Deprecated</h6>
                        <a class="dropdown-item"  href="/docs/latest/tutorials/map-reduce">MapReduce</a>
                    </div>
                </li>


                <!-- Algorithms (Samsara / MR) -->
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Algorithms</a>
                    <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                        <a class="dropdown-item"  href="/docs/latest/algorithms/linear-algebra">Distributed Linear Algebra</a>
                        <a class="dropdown-item"  href="/docs/latest/algorithms/preprocessors">Preprocessors</a>
                        <a class="dropdown-item"  href="/docs/latest/algorithms/regression">Regression</a>
                        <a class="dropdown-item"  href="/docs/latest/algorithms/clustering">Clustering</a>
                        <a class="dropdown-item"  href="/docs/latest/algorithms/recommenders">Recommenders</a>
                        <div class="dropdown-divider"></div>
                        <h6 class="dropdown-header">Deprecated</h6>
                        <a class="dropdown-item"  href="/docs/latest/algorithms/map-reduce">MapReduce <i>(deprecated)</i></a>
                    </div>
                        <!--<a class="dropdown-item"  href="/docs/latest/algorithms/recommenders/recommender-overview.html">Reccomender Overview</a></li> Do we still need? seems like short version of next post-->
                        <!--
                        <a class="dropdown-item"  href="/docs/latest/algorithms/recommenders/intro-cooccurrence-spark.html">Intro to Coocurrence With Spark</a></li>
                        <li role="separator" class="divider"></li>
                        <li><span>&nbsp;&nbsp;<a href="/docs/latest/algorithms/map-reduce"><b>MapReduce</b> (deprecated)</a><span></li>


                     -->
                </li>

                <!-- Scala /docs -->
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">API /docs</a>
                    <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                        <a class="dropdown-item"  href="/docs/0.13.0/api/docs/">0.13.0</a>
                    </div>
                </li>

                <!-- Apache -->
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Apache</a>
                    <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                        <a class="dropdown-item"  href="http://www.apache.org/foundation/how-it-works.html">Apache Software Foundation</a>
                        <a class="dropdown-item"  href="http://www.apache.org/licenses/">Apache License</a>
                        <a class="dropdown-item"  href="http://www.apache.org/foundation/sponsorship.html">Sponsorship</a>
                        <a class="dropdown-item"  href="http://www.apache.org/foundation/thanks.html">Thanks</a>
                    </div>
                </li>

            </ul>

                <!--<form class="navbar-form navbar-left">-->
                    <!--<div class="form-group">-->
                        <!--<input type="text" class="form-control" placeholder="Search">-->
                    <!--</div>-->
                    <!--<button type="submit" class="btn btn-default">Submit</button>-->
                <!--</form>-->
                <!--<ul class="nav navbar-nav navbar-right">-->
                    <!--<a class="dropdown-item"  href="http://github.com/apache/mahout">Github</a></li>-->



                <!--</ul>-->
        </div><!-- /.navbar-collapse -->
    </div>
</nav>


  <div class="container mt-5 pb-4">

  <div class="row">

    <div class="col-lg-8">
      <h1 id="naive-bayes">Naive Bayes</h1>

<h2 id="intro">Intro</h2>

<p>Mahout currently has two Naive Bayes Map-Reduce implementations.  The first is standard Multinomial Naive Bayes. The second is an implementation of Transformed Weight-normalized Complement Naive Bayes as introduced by Rennie et al. <a href="http://people.csail.mit.edu/jrennie/papers/icml03-nb.pdf">[1]</a>. We refer to the former as Bayes and the latter as CBayes.</p>

<p>Where Bayes has long been a standard in text classification, CBayes is an extension of Bayes that performs particularly well on datasets with skewed classes and has been shown to be competitive with algorithms of higher complexity such as Support Vector Machines.</p>

<h2 id="implementations">Implementations</h2>
<p>Both Bayes and CBayes are currently trained via MapReduce Jobs. Testing and classification can be done via a MapReduce Job or sequentially.  Mahout provides CLI drivers for preprocessing, training and testing. A Spark implementation is currently in the works (<a href="https://issues.apache.org/jira/browse/MAHOUT-1493">MAHOUT-1493</a>).</p>

<h2 id="preprocessing-and-algorithm">Preprocessing and Algorithm</h2>

<p>As described in <a href="http://people.csail.mit.edu/jrennie/papers/icml03-nb.pdf">[1]</a> Mahout Naive Bayes is broken down into the following steps (assignments are over all possible index values):</p>

<ul>
  <li>Let <code class="language-plaintext highlighter-rouge">\(\vec{d}=(\vec{d_1},...,\vec{d_n})\)</code> be a set of documents; <code class="language-plaintext highlighter-rouge">\(d_{ij}\)</code> is the count of word <code class="language-plaintext highlighter-rouge">\(i\)</code> in document <code class="language-plaintext highlighter-rouge">\(j\)</code>.</li>
  <li>Let <code class="language-plaintext highlighter-rouge">\(\vec{y}=(y_1,...,y_n)\)</code> be their labels.</li>
  <li>Let <code class="language-plaintext highlighter-rouge">\(\alpha_i\)</code> be a smoothing parameter for all words in the vocabulary; let <code class="language-plaintext highlighter-rouge">\(\alpha=\sum_i{\alpha_i}\)</code>.</li>
  <li><strong>Preprocessing</strong>(via seq2Sparse) TF-IDF transformation and L2 length normalization of <code class="language-plaintext highlighter-rouge">\(\vec{d}\)</code>
    <ol>
      <li><code class="language-plaintext highlighter-rouge">\(d_{ij} = \sqrt{d_{ij}}\)</code></li>
      <li><code class="language-plaintext highlighter-rouge">\(d_{ij} = d_{ij}\left(\log{\frac{\sum_k1}{\sum_k\delta_{ik}+1}}+1\right)\)</code></li>
      <li><code class="language-plaintext highlighter-rouge">\(d_{ij} =\frac{d_{ij}}{\sqrt{\sum_k{d_{kj}^2}}}\)</code></li>
    </ol>
  </li>
  <li><strong>Training: Bayes</strong><code class="language-plaintext highlighter-rouge">\((\vec{d},\vec{y})\)</code> calculate term weights <code class="language-plaintext highlighter-rouge">\(w_{ci}\)</code> as:
    <ol>
      <li><code class="language-plaintext highlighter-rouge">\(\hat\theta_{ci}=\frac{d_{ic}+\alpha_i}{\sum_k{d_{kc}}+\alpha}\)</code></li>
      <li><code class="language-plaintext highlighter-rouge">\(w_{ci}=\log{\hat\theta_{ci}}\)</code></li>
    </ol>
  </li>
  <li><strong>Training: CBayes</strong><code class="language-plaintext highlighter-rouge">\((\vec{d},\vec{y})\)</code> calculate term weights <code class="language-plaintext highlighter-rouge">\(w_{ci}\)</code> as:
    <ol>
      <li><code class="language-plaintext highlighter-rouge">\(\hat\theta_{ci} = \frac{\sum_{j:y_j\neq c}d_{ij}+\alpha_i}{\sum_{j:y_j\neq c}{\sum_k{d_{kj}}}+\alpha}\)</code></li>
      <li><code class="language-plaintext highlighter-rouge">\(w_{ci}=-\log{\hat\theta_{ci}}\)</code></li>
      <li><code class="language-plaintext highlighter-rouge">\(w_{ci}=\frac{w_{ci}}{\sum_i \lvert w_{ci}\rvert}\)</code></li>
    </ol>
  </li>
  <li><strong>Label Assignment/Testing:</strong>
    <ol>
      <li>Let <code class="language-plaintext highlighter-rouge">\(\vec{t}= (t_1,...,t_n)\)</code> be a test document; let <code class="language-plaintext highlighter-rouge">\(t_i\)</code> be the count of the word <code class="language-plaintext highlighter-rouge">\(t\)</code>.</li>
      <li>Label the document according to <code class="language-plaintext highlighter-rouge">\(l(t)=\arg\max_c \sum\limits_{i} t_i w_{ci}\)</code></li>
    </ol>
  </li>
</ul>

<p>As we can see, the main difference between Bayes and CBayes is the weight calculation step.  Where Bayes weighs terms more heavily based on the likelihood that they belong to class <code class="language-plaintext highlighter-rouge">\(c\)</code>, CBayes seeks to maximize term weights on the likelihood that they do not belong to any other class.</p>

<h2 id="running-from-the-command-line">Running from the command line</h2>

<p>Mahout provides CLI drivers for all above steps.  Here we will give a simple overview of Mahout CLI commands used to preprocess the data, train the model and assign labels to the training set. An <a href="https://github.com/apache/mahout/blob/master/examples/bin/classify-20newsgroups.sh">example script</a> is given for the full process from data acquisition through classification of the classic <a href="https://mahout.apache.org/users/classification/twenty-newsgroups.html">20 Newsgroups corpus</a>.</p>

<ul>
  <li>
    <p><strong>Preprocessing:</strong>
For a set of Sequence File Formatted documents in PATH_TO_SEQUENCE_FILES the <a href="https://mahout.apache.org/users/basics/creating-vectors-from-text.html">mahout seq2sparse</a> command performs the TF-IDF transformations (-wt tfidf option) and L2 length normalization (-n 2 option) as follows:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  mahout seq2sparse 
    -i ${PATH_TO_SEQUENCE_FILES} 
    -o ${PATH_TO_TFIDF_VECTORS} 
    -nv 
    -n 2
    -wt tfidf
</code></pre></div>    </div>
  </li>
  <li>
    <p><strong>Training:</strong>
The model is then trained using <code class="language-plaintext highlighter-rouge">mahout trainnb</code> .  The default is to train a Bayes model. The -c option is given to train a CBayes model:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  mahout trainnb
    -i ${PATH_TO_TFIDF_VECTORS} 
    -o ${PATH_TO_MODEL}/model 
    -li ${PATH_TO_MODEL}/labelindex 
    -ow 
    -c
</code></pre></div>    </div>
  </li>
  <li>
    <p><strong>Label Assignment/Testing:</strong>
Classification and testing on a holdout set can then be performed via <code class="language-plaintext highlighter-rouge">mahout testnb</code>. Again, the -c option indicates that the model is CBayes.  The -seq option tells <code class="language-plaintext highlighter-rouge">mahout testnb</code> to run sequentially:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  mahout testnb 
    -i ${PATH_TO_TFIDF_TEST_VECTORS}
    -m ${PATH_TO_MODEL}/model 
    -l ${PATH_TO_MODEL}/labelindex 
    -ow 
    -o ${PATH_TO_OUTPUT} 
    -c 
    -seq
</code></pre></div>    </div>
  </li>
</ul>

<h2 id="command-line-options">Command line options</h2>

<ul>
  <li>
    <p><strong>Preprocessing:</strong></p>

    <p>Only relevant parameters used for Bayes/CBayes as detailed above are shown. Several other transformations can be performed by <code class="language-plaintext highlighter-rouge">mahout seq2sparse</code> and used as input to Bayes/CBayes.  For a full list of <code class="language-plaintext highlighter-rouge">mahout seq2Sparse</code> options see the <a href="https://mahout.apache.org/users/basics/creating-vectors-from-text.html">Creating vectors from text</a> page.</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  mahout seq2sparse                         
    --output (-o) output             The directory pathname for output.        
    --input (-i) input               Path to job input directory.              
    --weight (-wt) weight            The kind of weight to use. Currently TF   
                                         or TFIDF. Default: TFIDF                  
    --norm (-n) norm                 The norm to use, expressed as either a    
                                         float or "INF" if you want to use the     
                                         Infinite norm.  Must be greater or equal  
                                         to 0.  The default is not to normalize    
    --overwrite (-ow)                If set, overwrite the output directory    
    --sequentialAccessVector (-seq)  (Optional) Whether output vectors should  
                                         be SequentialAccessVectors. If set true   
                                         else false                                
    --namedVector (-nv)              (Optional) Whether output vectors should  
                                         be NamedVectors. If set true else false   
</code></pre></div>    </div>
  </li>
  <li>
    <p><strong>Training:</strong></p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  mahout trainnb
    --input (-i) input               Path to job input directory.                 
    --output (-o) output             The directory pathname for output.                    
    --alphaI (-a) alphaI             Smoothing parameter. Default is 1.0
    --trainComplementary (-c)        Train complementary? Default is false.                        
    --labelIndex (-li) labelIndex    The path to store the label index in         
    --overwrite (-ow)                If present, overwrite the output directory   
                                         before running job                           
    --help (-h)                      Print out help                               
    --tempDir tempDir                Intermediate output directory                
    --startPhase startPhase          First phase to run                           
    --endPhase endPhase              Last phase to run
</code></pre></div>    </div>
  </li>
  <li>
    <p><strong>Testing:</strong></p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  mahout testnb   
    --input (-i) input               Path to job input directory.                  
    --output (-o) output             The directory pathname for output.            
    --overwrite (-ow)                If present, overwrite the output directory    
                                         before running job                                                

  
    --model (-m) model               The path to the model built during training   
    --testComplementary (-c)         Test complementary? Default is false.                          
    --runSequential (-seq)           Run sequential?                               
    --labelIndex (-l) labelIndex     The path to the location of the label index   
    --help (-h)                      Print out help                                
    --tempDir tempDir                Intermediate output directory                 
    --startPhase startPhase          First phase to run                            
    --endPhase endPhase              Last phase to run  
</code></pre></div>    </div>
  </li>
</ul>

<h2 id="examples">Examples</h2>

<p>Mahout provides an example for Naive Bayes classification:</p>

<ol>
  <li><a href="twenty-newsgroups.html">Classify 20 Newsgroups</a></li>
</ol>

<h2 id="references">References</h2>


    </div>


  </div>

</div>


  <footer class="footer bg-light">
    <div class="container text-center small">
        Copyright &copy; 2014-2024 <a href="http://www.apache.org/">The Apache Software Foundation</a>, Licensed under the Apache License, Version 2.0.
    </div>
</footer>


  <script src="/assets/vendor/jquery/jquery-slim.min.js"></script>
  <script src="/assets/vendor/popper/popper.min.js"></script>
  <script src="/assets/vendor/bootstrap/js/bootstrap.min.js"></script>
  <script src="/assets/header.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>

</body>

</html>
