<!DOCTYPE html>
<html lang=" en ">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>
    (Deprecated)  Partial Implementation
    
  </title>

  <meta name="description" content="Distributed Linear Algebra">

  <link rel="stylesheet" href="/assets/css/main.css">

  <!-- Font Awesome -->
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Maven+Pro:400,500" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Muli:400,400i,700,700i" rel="stylesheet">

  <link rel="canonical" href="http://mahout.apache.org//docs/latest/algorithms/map-reduce/classification/partial-implementation.html">
  <link rel="alternate" type="application/rss+xml" title="Apache Mahout" href="/feed.xml">


</head>


<body>

  <nav class="navbar navbar-expand-lg navbar-light bg-light navbar-mahout">

    <div class="container">

        <a class="navbar-brand" href="/">
            <img src="/assets/mahout-logo-blue.svg" alt="">
        </a>

        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarSupportedContent">

            <div class="navbar-nav ml-auto">

                <!-- Quick Start -->
                <li class="nav-item">
                    <a class="nav-link" href="/docs/latest" >Overview</a>
                </li>

                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Key Concepts</a>
                    <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                        <a class="dropdown-item"  href="/docs/latest/index.html">Mahout Overview</a>
                        <div class="dropdown-divider"></div>
                        <h6 class="dropdown-header">Scala DSL</h6>
                        <a class="dropdown-item"  href="/docs/latest/mahout-samsara/in-core-reference.html">In-core Reference</a>
                        <a class="dropdown-item"  href="/docs/latest/mahout-samsara/out-of-core-reference.html">Out-of-core Reference</a>
                        <a class="dropdown-item"  href="/docs/latest/mahout-samsara/faq.html">Samsara FAQ</a>
                        <div class="dropdown-divider"></div>
                        <h6 class="dropdown-header">Distributed Engine Bindings</h6>
                        <a class="dropdown-item"  href="/docs/latest/distributed/spark-bindings/">Spark Bindings</a>
                        <a class="dropdown-item"  href="/docs/latest/distributed/flink-bindings.html">Flink Bindings</a>
                        <a class="dropdown-item"  href="/docs/latest/distributed/flink-bindings.html">H20 Bindings</a>
                        <!--<div class="dropdown-divider"></div>
                        <h6 class="dropdown-header">Native Solvers</h6>
                        <a class="dropdown-item"  href="/docs/latest/native-solvers/viennacl.html">ViennaCL</a></li>
                        <a class="dropdown-item"  href="/docs/latest/native-solvers/viennacl-omp.html">ViennaCL-OMP</a></li>
                        <a class="dropdown-item"  href="/docs/latest/native-solvers/cuda.html">CUDA</a></li>-->
                    </div>
                </li>

                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Tutorial</a>
                    <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                        <div class="dropdown-divider"></div>
                        <h6 class="dropdown-header">Recommenders</h6>
                        <a class="dropdown-item"  href="/docs/latest/tutorials/cco-lastfm">CCO Example with Last.FM Data</a>
                        <a class="dropdown-item"  href="/docs/latest/tutorials/intro-cooccurrence-spark">Introduction to Cooccurrence in Spark</a>
                        <div class="dropdown-divider"></div>
                        <h6 class="dropdown-header">Mahout Samsara</h6>
                        <a class="dropdown-item"  href="/docs/latest/tutorials/samsara/play-with-shell.html">Playing with Samsara in Spark Shell</a>
                        <a class="dropdown-item"  href="/docs/latest/tutorials/samsara/playing-with-samsara-flink-batch.html">Playing with Samsara in Flink Batch</a>
                        <a class="dropdown-item"  href="/docs/latest/tutorials/samsara/classify-a-doc-from-the-shell.html">Text Classification (Shell)</a>
                        <a class="dropdown-item"  href="/docs/latest/tutorials/samsara/spark-naive-bayes.html">Spark Naive Bayes</a>
                        <div class="dropdown-divider"></div>
                        <h6 class="dropdown-header">Misc</h6>
                        <a class="dropdown-item"  href="/docs/latest/tutorials/misc/getting-started-with-zeppelin">Mahout in Apache Zeppelin (Quickstart)</a>
<!--                        <a class="dropdown-item"  href="/docs/latest/tutorials/misc/mahout-in-zeppelin">Mahout in Apache Zeppelin (Roll your own)</a>-->
                        <a class="dropdown-item"  href="/docs/latest/tutorials/misc/contributing-algos">How To Contribute a New Algorithm</a>
                        <a class="dropdown-item"  href="/docs/latest/tutorials/misc/how-to-build-an-app.html">How To Build An App</a>
                        <div class="dropdown-divider"></div>
                        <h6 class="dropdown-header">Deprecated</h6>
                        <a class="dropdown-item"  href="/docs/latest/tutorials/map-reduce">MapReduce</a>
                    </div>
                </li>


                <!-- Algorithms (Samsara / MR) -->
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Algorithms</a>
                    <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                        <a class="dropdown-item"  href="/docs/latest/algorithms/linear-algebra">Distributed Linear Algebra</a>
                        <a class="dropdown-item"  href="/docs/latest/algorithms/preprocessors">Preprocessors</a>
                        <a class="dropdown-item"  href="/docs/latest/algorithms/regression">Regression</a>
                        <a class="dropdown-item"  href="/docs/latest/algorithms/clustering">Clustering</a>
                        <a class="dropdown-item"  href="/docs/latest/algorithms/recommenders">Recommenders</a>
                        <div class="dropdown-divider"></div>
                        <h6 class="dropdown-header">Deprecated</h6>
                        <a class="dropdown-item"  href="/docs/latest/algorithms/map-reduce">MapReduce <i>(deprecated)</i></a>
                    </div>
                        <!--<a class="dropdown-item"  href="/docs/latest/algorithms/recommenders/recommender-overview.html">Reccomender Overview</a></li> Do we still need? seems like short version of next post-->
                        <!--
                        <a class="dropdown-item"  href="/docs/latest/algorithms/recommenders/intro-cooccurrence-spark.html">Intro to Coocurrence With Spark</a></li>
                        <li role="separator" class="divider"></li>
                        <li><span>&nbsp;&nbsp;<a href="/docs/latest/algorithms/map-reduce"><b>MapReduce</b> (deprecated)</a><span></li>


                     -->
                </li>

                <!-- Scala /docs -->
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">API /docs</a>
                    <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                        <a class="dropdown-item"  href="/docs/0.13.0/api/docs/">0.13.0</a>
                    </div>
                </li>

                <!-- Apache -->
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Apache</a>
                    <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                        <a class="dropdown-item"  href="http://www.apache.org/foundation/how-it-works.html">Apache Software Foundation</a>
                        <a class="dropdown-item"  href="http://www.apache.org/licenses/">Apache License</a>
                        <a class="dropdown-item"  href="http://www.apache.org/foundation/sponsorship.html">Sponsorship</a>
                        <a class="dropdown-item"  href="http://www.apache.org/foundation/thanks.html">Thanks</a>
                    </div>
                </li>

            </ul>

                <!--<form class="navbar-form navbar-left">-->
                    <!--<div class="form-group">-->
                        <!--<input type="text" class="form-control" placeholder="Search">-->
                    <!--</div>-->
                    <!--<button type="submit" class="btn btn-default">Submit</button>-->
                <!--</form>-->
                <!--<ul class="nav navbar-nav navbar-right">-->
                    <!--<a class="dropdown-item"  href="http://github.com/apache/mahout">Github</a></li>-->



                <!--</ul>-->
        </div><!-- /.navbar-collapse -->
    </div>
</nav>


  <div class="container mt-5 pb-4">

  <div class="row">

    <div class="col-lg-8">
      <h1 id="classifying-with-random-forests">Classifying with random forests</h1>

<p><a name="PartialImplementation-Introduction"></a></p>
<h1 id="introduction">Introduction</h1>

<p>This quick start page shows how to build a decision forest using the
partial implementation. This tutorial also explains how to use the decision
forest to classify new data.
Partial Decision Forests is a mapreduce implementation where each mapper
builds a subset of the forest using only the data available in its
partition. This allows building forests using large datasets as long as
each partition can be loaded in-memory.</p>

<p><a name="PartialImplementation-Steps"></a></p>
<h1 id="steps">Steps</h1>
<p><a name="PartialImplementation-Downloadthedata"></a></p>
<h2 id="download-the-data">Download the data</h2>
<ul>
  <li>The current implementation is compatible with the UCI repository file
format. In this example we’ll use the NSL-KDD dataset because its large
enough to show the performances of the partial implementation.
You can download the dataset here http://nsl.cs.unb.ca/NSL-KDD/
You can either download the full training set “KDDTrain+.ARFF”, or a 20%
subset “KDDTrain+_20Percent.ARFF” (we’ll use the full dataset in this
tutorial) and the test set “KDDTest+.ARFF”.</li>
  <li>Open the train and test files and remove all the lines that begin with
‘@’. All those lines are at the top of the files. Actually you can keep
those lines somewhere, because they’ll help us describe the dataset to
Mahout</li>
  <li>Put the data in HDFS: {code}
$HADOOP_HOME/bin/hadoop fs -mkdir testdata
$HADOOP_HOME/bin/hadoop fs -put <PATH TO="" DATA=""> testdata{code}</PATH></li>
</ul>

<p><a name="PartialImplementation-BuildtheJobfiles"></a></p>
<h2 id="build-the-job-files">Build the Job files</h2>
<ul>
  <li>In $MAHOUT_HOME/ run: {code}mvn clean install -DskipTests{code}</li>
</ul>

<p><a name="PartialImplementation-Generateafiledescriptorforthedataset:"></a></p>
<h2 id="generate-a-file-descriptor-for-the-dataset">Generate a file descriptor for the dataset:</h2>
<p>run the following command:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$HADOOP_HOME/bin/hadoop jar $MAHOUT_HOME/core/target/mahout-core-&lt;VERSION&gt;-job.jar org.apache.mahout.classifier.df.tools.Describe -p testdata/KDDTrain+.arff -f testdata/KDDTrain+.info -d N 3 C 2 N C 4 N C 8 N 2 C 19 N L
</code></pre></div></div>

<p>The “N 3 C 2 N C 4 N C 8 N 2 C 19 N L” string describes all the attributes
of the data. In this cases, it means 1 numerical(N) attribute, followed by
3 Categorical(C) attributes, …L indicates the label. You can also use ‘I’
to ignore some attributes</p>

<p><a name="PartialImplementation-Runtheexample"></a></p>
<h2 id="run-the-example">Run the example</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$HADOOP_HOME/bin/hadoop jar $MAHOUT_HOME/examples/target/mahout-examples-&lt;version&gt;-job.jar org.apache.mahout.classifier.df.mapreduce.BuildForest -Dmapred.max.split.size=1874231 -d testdata/KDDTrain+.arff -ds testdata/KDDTrain+.info -sl 5 -p -t 100 -o nsl-forest
</code></pre></div></div>

<p>which builds 100 trees (-t argument) using the partial implementation (-p).
Each tree is built using 5 random selected attribute per node (-sl
argument) and the example outputs the decision tree in the “nsl-forest”
directory (-o).
The number of partitions is controlled by the -Dmapred.max.split.size
argument that indicates to Hadoop the max. size of each partition, in this
case 1/10 of the size of the dataset. Thus 10 partitions will be used.
IMPORTANT: using less partitions should give better classification results,
but needs a lot of memory. So if the Jobs are failing, try increasing the
number of partitions.</p>
<ul>
  <li>
    <p>The example outputs the Build Time and the oob error estimation</p>

    <p>10/03/13 17:57:29 INFO mapreduce.BuildForest: Build Time: 0h 7m 43s 582
  10/03/13 17:57:33 INFO mapreduce.BuildForest: oob error estimate :
0.002325895231517865
  10/03/13 17:57:33 INFO mapreduce.BuildForest: Storing the forest in:
nsl-forest/forest.seq</p>
  </li>
</ul>

<p><a name="PartialImplementation-UsingtheDecisionForesttoClassifynewdata"></a></p>
<h2 id="using-the-decision-forest-to-classify-new-data">Using the Decision Forest to Classify new data</h2>
<p>run the following command:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$HADOOP_HOME/bin/hadoop jar $MAHOUT_HOME/examples/target/mahout-examples-&lt;version&gt;-job.jar org.apache.mahout.classifier.df.mapreduce.TestForest -i nsl-kdd/KDDTest+.arff -ds nsl-kdd/KDDTrain+.info -m nsl-forest -a -mr -o predictions
</code></pre></div></div>

<p>This will compute the predictions of “KDDTest+.arff” dataset (-i argument)
using the same data descriptor generated for the training dataset (-ds) and
the decision forest built previously (-m). Optionally (if the test dataset
contains the labels of the tuples) run the analyzer to compute the
confusion matrix (-a), and you can also store the predictions in a text
file or a directory of text files(-o). Passing the (-mr) parameter will use
Hadoop to distribute the classification.</p>

<ul>
  <li>
    <p>The example should output the classification time and the confusion
matrix</p>

    <p>10/03/13 18:08:56 INFO mapreduce.TestForest: Classification Time: 0h 0m 6s
355
  10/03/13 18:08:56 INFO mapreduce.TestForest:
=======================================================
  Summary
  ——————————————————-
  Correctly Classified Instances		:      17657	   78.3224%
  Incorrectly Classified Instances	:	4887	   21.6776%
  Total Classified Instances		:      22544</p>

    <p>=======================================================
  Confusion Matrix
  ——————————————————-
  a	b	&lt;–Classified as
  9459	252	 |  9711	a     = normal
  4635	8198	 |  12833	b     = anomaly
  Default Category: unknown: 2</p>
  </li>
</ul>

<p>If the input is a single file then the output will be a single text file,
in the above example ‘predictions’ would be one single file. If the input
if a directory containing for example two files ‘a.data’ and ‘b.data’, then
the output will be a directory ‘predictions’ containing two files
‘a.data.out’ and ‘b.data.out’</p>

<p><a name="PartialImplementation-KnownIssuesandlimitations"></a></p>
<h2 id="known-issues-and-limitations">Known Issues and limitations</h2>
<p>The “Decision Forest” code is still “a work in progress”, many features are
still missing. Here is a list of some known issues:</p>
<ul>
  <li>For now, the training does not support multiple input files. The input
dataset must be one single file (this support will be available with the upcoming release). 
Classifying new data does support multiple
input files.</li>
  <li>The tree building is done when each mapper.close() method is called.
Because the mappers don’t refresh their state, the job can fail when the
dataset is big and you try to build a large number of trees.</li>
</ul>

    </div>


  </div>

</div>


  <footer class="footer bg-light">
    <div class="container text-center small">
        Copyright &copy; 2014-2024 <a href="http://www.apache.org/">The Apache Software Foundation</a>, Licensed under the Apache License, Version 2.0.
    </div>
</footer>


  <script src="/assets/vendor/jquery/jquery-slim.min.js"></script>
  <script src="/assets/vendor/popper/popper.min.js"></script>
  <script src="/assets/vendor/bootstrap/js/bootstrap.min.js"></script>
  <script src="/assets/header.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>

</body>

</html>
