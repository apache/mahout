<!DOCTYPE html>
<html lang=" en ">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>
    Welcome to the Docs
    
  </title>

  <meta name="description" content="Distributed Linear Algebra">

  <link rel="stylesheet" href="/assets/css/main.css">

  <!-- Font Awesome -->
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Maven+Pro:400,500" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Muli:400,400i,700,700i" rel="stylesheet">

  <link rel="canonical" href="http://mahout.apache.org//docs/latest/">
  <link rel="alternate" type="application/rss+xml" title="Apache Mahout" href="/feed.xml">


</head>


<body>

  <nav class="navbar navbar-expand-lg navbar-light bg-light navbar-mahout">

    <div class="container">

        <a class="navbar-brand" href="/">
            <img src="/assets/mahout-logo-blue.svg" alt="">
        </a>

        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarSupportedContent">

            <div class="navbar-nav ml-auto">

                <!-- Quick Start -->
                <li class="nav-item">
                    <a class="nav-link" href="/docs/latest" >Overview</a>
                </li>

                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Key Concepts</a>
                    <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                        <a class="dropdown-item"  href="/docs/latest/index.html">Mahout Overview</a>
                        <div class="dropdown-divider"></div>
                        <h6 class="dropdown-header">Scala DSL</h6>
                        <a class="dropdown-item"  href="/docs/latest/mahout-samsara/in-core-reference.html">In-core Reference</a>
                        <a class="dropdown-item"  href="/docs/latest/mahout-samsara/out-of-core-reference.html">Out-of-core Reference</a>
                        <a class="dropdown-item"  href="/docs/latest/mahout-samsara/faq.html">Samsara FAQ</a>
                        <div class="dropdown-divider"></div>
                        <h6 class="dropdown-header">Distributed Engine Bindings</h6>
                        <a class="dropdown-item"  href="/docs/latest/distributed/spark-bindings/">Spark Bindings</a>
                        <a class="dropdown-item"  href="/docs/latest/distributed/flink-bindings.html">Flink Bindings</a>
                        <a class="dropdown-item"  href="/docs/latest/distributed/flink-bindings.html">H20 Bindings</a>
                        <!--<div class="dropdown-divider"></div>
                        <h6 class="dropdown-header">Native Solvers</h6>
                        <a class="dropdown-item"  href="/docs/latest/native-solvers/viennacl.html">ViennaCL</a></li>
                        <a class="dropdown-item"  href="/docs/latest/native-solvers/viennacl-omp.html">ViennaCL-OMP</a></li>
                        <a class="dropdown-item"  href="/docs/latest/native-solvers/cuda.html">CUDA</a></li>-->
                    </div>
                </li>

                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Tutorial</a>
                    <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                        <div class="dropdown-divider"></div>
                        <h6 class="dropdown-header">Recommenders</h6>
                        <a class="dropdown-item"  href="/docs/latest/tutorials/cco-lastfm">CCO Example with Last.FM Data</a>
                        <a class="dropdown-item"  href="/docs/latest/tutorials/intro-cooccurrence-spark">Introduction to Cooccurrence in Spark</a>
                        <div class="dropdown-divider"></div>
                        <h6 class="dropdown-header">Mahout Samsara</h6>
                        <a class="dropdown-item"  href="/docs/latest/tutorials/samsara/play-with-shell.html">Playing with Samsara in Spark Shell</a>
                        <a class="dropdown-item"  href="/docs/latest/tutorials/samsara/playing-with-samsara-flink-batch.html">Playing with Samsara in Flink Batch</a>
                        <a class="dropdown-item"  href="/docs/latest/tutorials/samsara/classify-a-doc-from-the-shell.html">Text Classification (Shell)</a>
                        <a class="dropdown-item"  href="/docs/latest/tutorials/samsara/spark-naive-bayes.html">Spark Naive Bayes</a>
                        <div class="dropdown-divider"></div>
                        <h6 class="dropdown-header">Misc</h6>
                        <a class="dropdown-item"  href="/docs/latest/tutorials/misc/getting-started-with-zeppelin">Mahout in Apache Zeppelin (Quickstart)</a>
<!--                        <a class="dropdown-item"  href="/docs/latest/tutorials/misc/mahout-in-zeppelin">Mahout in Apache Zeppelin (Roll your own)</a>-->
                        <a class="dropdown-item"  href="/docs/latest/tutorials/misc/contributing-algos">How To Contribute a New Algorithm</a>
                        <a class="dropdown-item"  href="/docs/latest/tutorials/misc/how-to-build-an-app.html">How To Build An App</a>
                        <div class="dropdown-divider"></div>
                        <h6 class="dropdown-header">Deprecated</h6>
                        <a class="dropdown-item"  href="/docs/latest/tutorials/map-reduce">MapReduce</a>
                    </div>
                </li>


                <!-- Algorithms (Samsara / MR) -->
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Algorithms</a>
                    <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                        <a class="dropdown-item"  href="/docs/latest/algorithms/linear-algebra">Distributed Linear Algebra</a>
                        <a class="dropdown-item"  href="/docs/latest/algorithms/preprocessors">Preprocessors</a>
                        <a class="dropdown-item"  href="/docs/latest/algorithms/regression">Regression</a>
                        <a class="dropdown-item"  href="/docs/latest/algorithms/clustering">Clustering</a>
                        <a class="dropdown-item"  href="/docs/latest/algorithms/recommenders">Recommenders</a>
                        <div class="dropdown-divider"></div>
                        <h6 class="dropdown-header">Deprecated</h6>
                        <a class="dropdown-item"  href="/docs/latest/algorithms/map-reduce">MapReduce <i>(deprecated)</i></a>
                    </div>
                        <!--<a class="dropdown-item"  href="/docs/latest/algorithms/recommenders/recommender-overview.html">Reccomender Overview</a></li> Do we still need? seems like short version of next post-->
                        <!--
                        <a class="dropdown-item"  href="/docs/latest/algorithms/recommenders/intro-cooccurrence-spark.html">Intro to Coocurrence With Spark</a></li>
                        <li role="separator" class="divider"></li>
                        <li><span>&nbsp;&nbsp;<a href="/docs/latest/algorithms/map-reduce"><b>MapReduce</b> (deprecated)</a><span></li>


                     -->
                </li>

                <!-- Scala /docs -->
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">API /docs</a>
                    <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                        <a class="dropdown-item"  href="/docs/0.13.0/api/docs/">0.13.0</a>
                    </div>
                </li>

                <!-- Apache -->
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Apache</a>
                    <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                        <a class="dropdown-item"  href="http://www.apache.org/foundation/how-it-works.html">Apache Software Foundation</a>
                        <a class="dropdown-item"  href="http://www.apache.org/licenses/">Apache License</a>
                        <a class="dropdown-item"  href="http://www.apache.org/foundation/sponsorship.html">Sponsorship</a>
                        <a class="dropdown-item"  href="http://www.apache.org/foundation/thanks.html">Thanks</a>
                    </div>
                </li>

            </ul>

                <!--<form class="navbar-form navbar-left">-->
                    <!--<div class="form-group">-->
                        <!--<input type="text" class="form-control" placeholder="Search">-->
                    <!--</div>-->
                    <!--<button type="submit" class="btn btn-default">Submit</button>-->
                <!--</form>-->
                <!--<ul class="nav navbar-nav navbar-right">-->
                    <!--<a class="dropdown-item"  href="http://github.com/apache/mahout">Github</a></li>-->



                <!--</ul>-->
        </div><!-- /.navbar-collapse -->
    </div>
</nav>


  <div class="container mt-5 pb-4">

  <div class="row">

    <div class="col-lg-8">
      <p>You’ve probably already noticed Mahout has a lot of things going on at different levels, and it can be hard to know where
to start.  Let’s provide an overview to help you see how the pieces fit together. In general the stack is something like this:</p>

<ol>
  <li>Application Code</li>
  <li>Samsara Scala-DSL (Syntactic Sugar)</li>
  <li>Logical/Physical DAG</li>
  <li>Engine Bindings</li>
  <li>Code runs in Engine</li>
  <li>Native Solvers</li>
</ol>

<h2 id="application-code">Application Code</h2>

<p>You have an JAVA/Scala applicatoin (skip this if you’re working from an interactive shell or Apache Zeppelin)</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>def main(args: Array[String]) {

  println("Welcome to My Mahout App")

  if (args.isEmpty) {
</code></pre></div></div>

<p>This may seem like a trivial part to call out, but the point is important- Mahout runs <em>inline</em> with your regular application 
code. E.g. if this is an Apache Spark app, then you do all your Spark things, including ETL and data prep in the same 
application, and then invoke Mahout’s mathematically expressive Scala DSL when you’re ready to math on it.</p>

<h2 id="samsara-scala-dsl-syntactic-sugar">Samsara Scala-DSL (Syntactic Sugar)</h2>

<p>So when you get to a point in your code where you’re ready to math it up (in this example Spark) you can elegantly express 
yourself mathematically.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>implicit val sdc: org.apache.mahout.sparkbindings.SparkDistributedContext = sc2sdc(sc)

val A = drmWrap(rddA)
val B = drmWrap(rddB) 

val C = A.t %*% A + A %*% B.t
</code></pre></div></div>

<p>We’ve defined a <code class="language-plaintext highlighter-rouge">MahoutDistributedContext</code> (which is a wrapper on the Spark Context), and two Distributed Row Matrices (DRMs)
which are wrappers around RDDs (in Spark).</p>

<h2 id="logical--physical-dag">Logical / Physical DAG</h2>

<p>At this point there is a bit of optimization that happens.  For example, consider the</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>A.t %*% A
</code></pre></div></div>

<p>Which is</p>
<center>\(\mathbf{A^\intercal A}\)</center>

<p>Transposing a large matrix is a very expensive thing to do, and in this case we don’t actually need to do it: there is a
more efficient way to calculate <foo>\(\mathbf{A^\intercal A}\)</foo> that doesn’t require a physical transpose.</p>

<p>(Image showing this)</p>

<p>Mahout converts this code into something that looks like:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>OpAtA(A) + OpABt(A, B) //  illustrative pseudocode with real functions called
</code></pre></div></div>

<p>There’s a little more magic that happens at this level, but the punchline is <em>Mahout translates the pretty scala into a
a series of operators, which are implemented at engine level</em>.</p>

<h2 id="engine-bindings-and-engine-level-ops">Engine Bindings and Engine Level Ops</h2>

<p>When one creates new engine bindings, one is in essence defining:</p>

<ol>
  <li>What the engine specific underlying structure for a DRM is (in Spark its an RDD).  The underlying structure also has 
rows of <code class="language-plaintext highlighter-rouge">MahoutVector</code>s, so in Spark <code class="language-plaintext highlighter-rouge">RDD[(index, MahoutVector)]</code>.  This will be important when we get to the native solvers.</li>
  <li>Implementing a set of BLAS (basic linear algebra) functions for working on the underlying structure- in Spark this means
implementing things like <code class="language-plaintext highlighter-rouge">AtA</code> on an RDD. See <a href="https://github.com/apache/mahout/tree/master/spark/src/main/scala/org/apache/mahout/sparkbindings">the sparkbindings on github</a></li>
</ol>

<p>Now your mathematically expressive Samsara Scala code has been translated into optimized engine specific functions.</p>

<h2 id="native-solvers">Native Solvers</h2>

<p>Recall how I said that rows of the DRMs are <code class="language-plaintext highlighter-rouge">org.apache.mahout.math.Vector</code>.  Here is where this becomes important. I’m going 
to explain this in the context of Spark, but the principals apply to all distributed backends.</p>

<p>If you are familiar with how mapping and reducing in Spark, then envision this RDD of <code class="language-plaintext highlighter-rouge">MahoutVector</code>s,  each partition, 
and indexed collection of vectors is a <em>block</em> of the distributed matrix, however this <em>block</em> is totally in-core, and therefor is treated like an in-core matrix.</p>

<p>Now Mahout defines its own in-core BLAS packs and refers to them as <em>Native Solvers</em>.  The default native solver is just plain
old JVM, which is painfully slow, but works just about anywhere.</p>

<p>When the data gets to the node, an operation on the matrix block is called.  In the same way Mahout converts abstract
operators on the DRM that are implemented on various distributed engines, it calls abstract operators on the in-core matrix 
and vectors which are implemented on various native solvers.</p>

<p>The default “native solver” is the JVM, which isn’t native at all, and if no actual native solvers are present operations 
will fall back to this. However, IF a native solver is present (the jar was added to the notebook), then the magic will happen.</p>

<p>Imagine still we have our Spark executor: it has this block of a matrix sitting in its core. Now let’s suppose the <code class="language-plaintext highlighter-rouge">ViennaCl-OMP</code>
native solver is in use.  When Spark calls an operation on this incore matrix, the matrix dumps out of the JVM and the 
calculation is carried out on <em>all available CPUs</em>.</p>

<p>In a similar way, the <code class="language-plaintext highlighter-rouge">ViennaCL</code> native solver dumps the matrix out of the JVM and looks for a GPU to execute the operations on.</p>

<p>Once the operations are complete, the result is loaded back up into the JVM, and Spark (or whatever distributed engine) and 
shipped back to the driver.</p>

<p>The native solver operations are only defined on <code class="language-plaintext highlighter-rouge">org.apache.mahout.math.Vector</code> and <code class="language-plaintext highlighter-rouge">org.apache.mahout.math.Matrix</code>, which is 
why it is critical that the underlying structure is composed row-wise by <code class="language-plaintext highlighter-rouge">Vector</code> or <code class="language-plaintext highlighter-rouge">Matrices</code>.</p>


    </div>


  </div>

</div>


  <footer class="footer bg-light">
    <div class="container text-center small">
        Copyright &copy; 2014-2024 <a href="http://www.apache.org/">The Apache Software Foundation</a>, Licensed under the Apache License, Version 2.0.
    </div>
</footer>


  <script src="/assets/vendor/jquery/jquery-slim.min.js"></script>
  <script src="/assets/vendor/popper/popper.min.js"></script>
  <script src="/assets/vendor/bootstrap/js/bootstrap.min.js"></script>
  <script src="/assets/header.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>

</body>

</html>
