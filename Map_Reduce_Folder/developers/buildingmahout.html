<h1 id="building-mahout-from-source">Building Mahout from Source</h1>

<h2 id="prerequisites">Prerequisites</h2>

<ul>
  <li>Java JDK 1.7</li>
  <li>Apache Maven 3.3.9</li>
</ul>

<p><a name="getting-code"></a></p>
<h2 id="getting-the-source-code">Getting the source code</h2>

<p>Checkout the sources from the <a href="https://github.com/apache/mahout">Mahout GitHub repository</a>
either via</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone git@github.com:apache/mahout.git or
 
git clone https://github.com/apache/mahout.git
</code></pre></div></div>

<h2 id="building-from-source">Building From Source</h2>

<h6 id="prerequisites-1">Prerequisites:</h6>

<p>Linux Environment (preferably Ubuntu 16.04.x) Note: Currently only the JVM-only build will work on a Mac.
gcc &gt; 4.x
NVIDIA Card (installed with OpenCL drivers alongside usual GPU drivers)</p>

<h6 id="downloads">Downloads</h6>

<p>Install java 1.7+ in an easily accessible directory (for this example,  ~/java/)
http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html</p>

<p>Create a directory ~/apache/ .</p>

<p>Download apache Maven 3.3.9 and un-tar/gunzip to ~/apache/apache-maven-3.3.9/ .
https://maven.apache.org/download.cgi</p>

<p>Download and un-tar/gunzip Hadoop 2.4.1 to ~/apache/hadoop-2.4.1/ .
https://archive.apache.org/dist/hadoop/common/hadoop-2.4.1/</p>

<p>Download and un-tar/gunzip spark-1.6.3-bin-hadoop2.4 to  ~/apache/ .
http://spark.apache.org/downloads.html
Choose release: Spark-1.6.3 (Nov 07 2016)
Choose package type: Pre-Built for Hadoop 2.4</p>

<p>Install ViennaCL 1.7.0+
If running Ubuntu 16.04+</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo apt-get install libviennacl-dev
</code></pre></div></div>

<p>Otherwise if your distribution’s package manager does not have a viennniacl-dev package &gt;1.7.0, clone it directly into the directory which will be included in when  being compiled by Mahout:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkdir ~/tmp
cd ~/tmp &amp;&amp; git clone https://github.com/viennacl/viennacl-dev.git
cp -r viennacl/ /usr/local/
cp -r CL/ /usr/local/
</code></pre></div></div>

<p>Ensure that the OpenCL 1.2+ drivers are installed (packed with most consumer grade NVIDIA drivers).  Not sure about higher end cards.</p>

<p>Clone mahout repository into <code class="language-plaintext highlighter-rouge">~/apache</code>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone https://github.com/apache/mahout.git
</code></pre></div></div>

<h6 id="configuration">Configuration</h6>

<p>When building mahout for a spark backend, we need four System Environment variables set:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    export MAHOUT_HOME=/home/&lt;user&gt;/apache/mahout
    export HADOOP_HOME=/home/&lt;user&gt;/apache/hadoop-2.4.1
    export SPARK_HOME=/home/&lt;user&gt;/apache/spark-1.6.3-bin-hadoop2.4    
    export JAVA_HOME=/home/&lt;user&gt;/java/jdk-1.8.121
</code></pre></div></div>

<p>Mahout on Spark regularly uses one more env variable, the IP of the Spark cluster’s master node (usually the node which one would be logged into).</p>

<p>To use 4 local cores (Spark master need not be running)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>export MASTER=local[4]
</code></pre></div></div>
<p>To use all available local cores (again, Spark master need not be running)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>export MASTER=local[*]
</code></pre></div></div>
<p>To point to a cluster with spark running:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>export MASTER=spark://master.ip.address:7077
</code></pre></div></div>

<p>We then add these to the path:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   PATH=$PATH$:MAHOUT_HOME/bin:$HADOOP_HOME/bin:$SPARK_HOME/bin:$JAVA_HOME/bin
</code></pre></div></div>

<p>These should be added to the your ~/.bashrc file.</p>

<h6 id="building-mahout-with-apache-maven">Building Mahout with Apache Maven</h6>

<p>From the  $MAHOUT_HOME directory we may issue the commands to build each using mvn profiles.</p>

<p>JVM only:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mvn clean install -DskipTests
</code></pre></div></div>

<p>JVM with native OpenMP level 2 and level 3 matrix/vector Multiplication</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mvn clean install -Pviennacl-omp -DskipTests
</code></pre></div></div>
<p>JVM with native OpenMP and OpenCL for Level 2 and level 3 matrix/vector Multiplication.  (GPU errors fall back to OpenMP, currently only a single GPU/node is supported).</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mvn clean install -Pviennacl -DskipTests
</code></pre></div></div>

<h3 id="profiles-reference">Profiles Reference</h3>

<p>Apache Maven encourages users to make use of build profiles for selectively building modules.</p>

<p>The command</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mvn clean package
</code></pre></div></div>

<p>Is the basic build command. This default will build the following packages.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>INFO] Apache Mahout 
<span class="o">[</span>INFO] Mahout Core 
<span class="o">[</span>INFO] Mahout Engine 
<span class="o">[</span>INFO] - Mahout HDFS Support 
<span class="o">[</span>INFO] - Mahout Spark Engine 
<span class="o">[</span>INFO] Mahout Community 
<span class="o">[</span>INFO] - Mahout Spark CLI Drivers 
</code></pre></div></div>

<p>The following profiles are available for building optional components:</p>
<center>
	<table>
		<tr>
			<th>Profile</th>
			<th colspan="5">Description</th>
		</tr>
		<tr>
			<td><code>all</code></td>
			<td>Build all modules</td>
		<tr>
			<td><code>apache-release</code></td>
			<td>Used for releasing Apache Mahout. See <a href="how-to-release.html">How To Release</a> for more information.</td>
		</tr>
		<tr>
			<td><code>flink-batch</code></td>
			<td>Build Community Engine of Mahout for Apache Flink (Batch)</td>
		</tr>
		<tr>
			<td><code>h2o</code></td>
			<td>Build Community Engine of Mahout for H2o</td>
		</tr>
		<tr>
			<td><code>mahout-mr</code></td>
			<td>Build Community maintained Mahout for Map Reduce</td>
		<tr>
			<td><code>viennacl</code></td>
			<td>Build Experimental ViennaCL (GPU) BLAS Pack</td>
		</tr>
		<tr>
			<td><code>viennacl-omp</code></td>
			<td>Build Experimental ViennaCL-OpenMP (CPU) BLAS Pack</td>
		<tr>
		<tr>
			<td><code>docs</code></td>
			<td>Profile for building Java/Scala Docs</td>
		<tr>
			<th>Mahout Specific Option</th>
			<th>Description</th>
		</tr>
		<tr>
			<td><code>skipCli</code></td>
			<td>Skip building the command line drivers for Mahout on Apache Spark</td>
		</tr>
	&lt;/table&gt;
&lt;/center&gt;

#### Example

If you want to build Apache Mahout with ViennaCL OpenMP support but skip the command line Spark drivers you would use this 
command to build:

```bash
mvn clean package -Pviennacl-omp -DskipCli
```

#### Building Java/Scala Docs

To build the Java/Scala docs use the maven `site` goal and the `docs` profile. 

Additionally, passing the `-Ddependency.locations.enabled=false` option will skip checking the dependency location and allow a much faster build.
  
```bash
mvn clean site -Pall,docs -Ddependency.locations.enabled=false
```



</tr></tr></tr></tr></tr></table></center>
