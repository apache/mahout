<!DOCTYPE html>
<html lang=" en ">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>
    CCOs with Last.fm
    
  </title>

  <meta name="description" content="Distributed Linear Algebra">

  <link rel="stylesheet" href="/assets/css/main.css">

  <!-- Font Awesome -->
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Maven+Pro:400,500" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Muli:400,400i,700,700i" rel="stylesheet">

  <link rel="canonical" href="http://mahout.apache.org//Map_Reduce_Folder/tutorials/cco-last-fm/">
  <link rel="alternate" type="application/rss+xml" title="Apache Mahout" href="/feed.xml">

  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS_HTML">
    MathJax.Hub.Config({
      "HTML-CSS": {
        availableFonts: ["TeX"],
      },
      tex2jax: {
        inlineMath: [['$','$'],["\\(","\\)"]]},
      displayMath: [ ['$$','$$'], ['\[','\]'] ],
      TeX: {
        extensions: ["AMSmath.js", "AMSsymbols.js", "color.js"],
        equationNumbers: {
          autoNumber: "AMS"
        }
      },
      showProcessingMessages: false,
      messageStyle: "none",
      imageFont: null,
      "AssistiveMML": { disabled: true }
    });
  </script>
</head>


<body>

  <nav class="navbar navbar-expand-lg navbar-light bg-light navbar-mahout">

    <div class="container">

        <a class="navbar-brand" href="/">
            <img src="/assets/mahout-logo-blue.svg" alt="">
        </a>

        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarSupportedContent">

            <div class="navbar-nav ml-auto">

                <!-- Quick Start -->
                <li class="nav-item">
                    <a class="nav-link" href="/docs/latest" >Overview</a>
                </li>

                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Key Concepts</a>
                    <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                        <a class="dropdown-item"  href="/docs/latest/index.html">Mahout Overview</a>
                        <div class="dropdown-divider"></div>
                        <h6 class="dropdown-header">Scala DSL</h6>
                        <a class="dropdown-item"  href="/docs/latest/mahout-samsara/in-core-reference.html">In-core Reference</a>
                        <a class="dropdown-item"  href="/docs/latest/mahout-samsara/out-of-core-reference.html">Out-of-core Reference</a>
                        <a class="dropdown-item"  href="/docs/latest/mahout-samsara/faq.html">Samsara FAQ</a>
                        <div class="dropdown-divider"></div>
                        <h6 class="dropdown-header">Distributed Engine Bindings</h6>
                        <a class="dropdown-item"  href="/docs/latest/distributed/spark-bindings/">Spark Bindings</a>
                        <a class="dropdown-item"  href="/docs/latest/distributed/flink-bindings.html">Flink Bindings</a>
                        <a class="dropdown-item"  href="/docs/latest/distributed/flink-bindings.html">H20 Bindings</a>
                        <!--<div class="dropdown-divider"></div>
                        <h6 class="dropdown-header">Native Solvers</h6>
                        <a class="dropdown-item"  href="/docs/latest/native-solvers/viennacl.html">ViennaCL</a></li>
                        <a class="dropdown-item"  href="/docs/latest/native-solvers/viennacl-omp.html">ViennaCL-OMP</a></li>
                        <a class="dropdown-item"  href="/docs/latest/native-solvers/cuda.html">CUDA</a></li>-->
                    </div>
                </li>

                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Tutorial</a>
                    <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                        <div class="dropdown-divider"></div>
                        <h6 class="dropdown-header">Recommenders</h6>
                        <a class="dropdown-item"  href="/docs/latest/tutorials/cco-lastfm">CCO Example with Last.FM Data</a>
                        <a class="dropdown-item"  href="/docs/latest/tutorials/intro-cooccurrence-spark">Introduction to Cooccurrence in Spark</a>
                        <div class="dropdown-divider"></div>
                        <h6 class="dropdown-header">Mahout Samsara</h6>
                        <a class="dropdown-item"  href="/docs/latest/tutorials/samsara/play-with-shell.html">Playing with Samsara in Spark Shell</a>
                        <a class="dropdown-item"  href="/docs/latest/tutorials/samsara/playing-with-samsara-flink-batch.html">Playing with Samsara in Flink Batch</a>
                        <a class="dropdown-item"  href="/docs/latest/tutorials/samsara/classify-a-doc-from-the-shell.html">Text Classification (Shell)</a>
                        <a class="dropdown-item"  href="/docs/latest/tutorials/samsara/spark-naive-bayes.html">Spark Naive Bayes</a>
                        <div class="dropdown-divider"></div>
                        <h6 class="dropdown-header">Misc</h6>
                        <a class="dropdown-item"  href="/docs/latest/tutorials/misc/getting-started-with-zeppelin">Mahout in Apache Zeppelin (Quickstart)</a>
<!--                        <a class="dropdown-item"  href="/docs/latest/tutorials/misc/mahout-in-zeppelin">Mahout in Apache Zeppelin (Roll your own)</a>-->
                        <a class="dropdown-item"  href="/docs/latest/tutorials/misc/contributing-algos">How To Contribute a New Algorithm</a>
                        <a class="dropdown-item"  href="/docs/latest/tutorials/misc/how-to-build-an-app.html">How To Build An App</a>
                        <div class="dropdown-divider"></div>
                        <h6 class="dropdown-header">Deprecated</h6>
                        <a class="dropdown-item"  href="/docs/latest/tutorials/map-reduce">MapReduce</a>
                    </div>
                </li>


                <!-- Algorithms (Samsara / MR) -->
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Algorithms</a>
                    <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                        <a class="dropdown-item"  href="/docs/latest/algorithms/linear-algebra">Distributed Linear Algebra</a>
                        <a class="dropdown-item"  href="/docs/latest/algorithms/preprocessors">Preprocessors</a>
                        <a class="dropdown-item"  href="/docs/latest/algorithms/regression">Regression</a>
                        <a class="dropdown-item"  href="/docs/latest/algorithms/clustering">Clustering</a>
                        <a class="dropdown-item"  href="/docs/latest/algorithms/recommenders">Recommenders</a>
                        <div class="dropdown-divider"></div>
                        <h6 class="dropdown-header">Deprecated</h6>
                        <a class="dropdown-item"  href="/docs/latest/algorithms/map-reduce">MapReduce <i>(deprecated)</i></a>
                    </div>
                        <!--<a class="dropdown-item"  href="/docs/latest/algorithms/recommenders/recommender-overview.html">Reccomender Overview</a></li> Do we still need? seems like short version of next post-->
                        <!--
                        <a class="dropdown-item"  href="/docs/latest/algorithms/recommenders/intro-cooccurrence-spark.html">Intro to Coocurrence With Spark</a></li>
                        <li role="separator" class="divider"></li>
                        <li><span>&nbsp;&nbsp;<a href="/docs/latest/algorithms/map-reduce"><b>MapReduce</b> (deprecated)</a><span></li>


                     -->
                </li>

                <!-- Scala /docs -->
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">API /docs</a>
                    <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                        <a class="dropdown-item"  href="/docs/0.13.0/api/docs/">0.13.0</a>
                    </div>
                </li>

                <!-- Apache -->
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Apache</a>
                    <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                        <a class="dropdown-item"  href="http://www.apache.org/foundation/how-it-works.html">Apache Software Foundation</a>
                        <a class="dropdown-item"  href="http://www.apache.org/licenses/">Apache License</a>
                        <a class="dropdown-item"  href="http://www.apache.org/foundation/sponsorship.html">Sponsorship</a>
                        <a class="dropdown-item"  href="http://www.apache.org/foundation/thanks.html">Thanks</a>
                    </div>
                </li>

            </ul>

                <!--<form class="navbar-form navbar-left">-->
                    <!--<div class="form-group">-->
                        <!--<input type="text" class="form-control" placeholder="Search">-->
                    <!--</div>-->
                    <!--<button type="submit" class="btn btn-default">Submit</button>-->
                <!--</form>-->
                <!--<ul class="nav navbar-nav navbar-right">-->
                    <!--<a class="dropdown-item"  href="http://github.com/apache/mahout">Github</a></li>-->



                <!--</ul>-->
        </div><!-- /.navbar-collapse -->
    </div>
</nav>


  <div class="container mt-5 pb-4">

  <div class="row">

    <div class="col-lg-8">
      <p>Most recommender examples utilize the MovieLense dataset, but that relies only on ratings (which makes the recommender being demonstrated look less trivial).  Right next to the MovieLense dataset is the LastFM data set.  The LastFM dataset has ratings by user, friends of the user, bands listened to by user, and tags by user.  This is the kind of exciting data set we’d like to work with!</p>

<p>Start by downloading the LastFM dataset from
http://files.grouplens.org/datasets/hetrec2011/hetrec2011-lastfm-2k.zip</p>

<p>I’m going to assume you’ve unzipped them to /path/to/lastfm/*
We’re going to use a new trick for creating our IndexedDataSets, the <code class="language-plaintext highlighter-rouge">apply</code> function.  <code class="language-plaintext highlighter-rouge">apply</code> takes an <code class="language-plaintext highlighter-rouge">RDD[(String, String)]</code> that is an RDD of tuples where both elements are strings. We load RDDs, and use Spark to manipulate the RDDs into this form.  The files from LastFM are tab seperated- but it should be noted, that this could easily be done from log files, but would just take a touch more Spark-Fu.</p>

<p>The second important thing to note is that the first element in each tuple is going to be the rows in the resulting matrix, the second element will be the column, and at that position there will be a one.  The BiDictionary will automatically be created from the strings.
For those following along at home- <a href="cco-lastfm.scala">the full Scala worksheet</a> might be easier than copying and pasting
from this page.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">org.apache.mahout.sparkbindings.indexeddataset.IndexedDatasetSpark</span>

<span class="k">val</span> <span class="nv">userTagsRDD</span> <span class="k">=</span> <span class="nv">sc</span><span class="o">.</span><span class="py">textFile</span><span class="o">(</span><span class="s">"/path/to/lastfm/user_taggedartists.dat"</span><span class="o">)</span>
<span class="o">.</span><span class="py">map</span><span class="o">(</span><span class="n">line</span> <span class="k">=&gt;</span> <span class="nv">line</span><span class="o">.</span><span class="py">split</span><span class="o">(</span><span class="s">"\t"</span><span class="o">))</span>
<span class="o">.</span><span class="py">map</span><span class="o">(</span><span class="n">a</span> <span class="k">=&gt;</span> <span class="o">(</span><span class="nf">a</span><span class="o">(</span><span class="mi">0</span><span class="o">),</span> <span class="nf">a</span><span class="o">(</span><span class="mi">2</span><span class="o">)))</span>
<span class="o">.</span><span class="py">filter</span><span class="o">(</span><span class="nv">_</span><span class="o">.</span><span class="py">_1</span> <span class="o">!=</span> <span class="s">"userID"</span><span class="o">)</span>
<span class="k">val</span> <span class="nv">userTagsIDS</span> <span class="k">=</span> <span class="nv">IndexedDatasetSpark</span><span class="o">.</span><span class="py">apply</span><span class="o">(</span><span class="n">userTagsRDD</span><span class="o">)(</span><span class="n">sc</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">userArtistsRDD</span> <span class="k">=</span> <span class="nv">sc</span><span class="o">.</span><span class="py">textFile</span><span class="o">(</span><span class="s">"/path/to/lastfm/user_artists.dat"</span><span class="o">)</span>
													<span class="o">.</span><span class="py">map</span><span class="o">(</span><span class="n">line</span> <span class="k">=&gt;</span> <span class="nv">line</span><span class="o">.</span><span class="py">split</span><span class="o">(</span><span class="s">"\t"</span><span class="o">))</span>
													<span class="o">.</span><span class="py">map</span><span class="o">(</span><span class="n">a</span> <span class="k">=&gt;</span> <span class="o">(</span><span class="nf">a</span><span class="o">(</span><span class="mi">0</span><span class="o">),</span> <span class="nf">a</span><span class="o">(</span><span class="mi">1</span><span class="o">)))</span>
										      <span class="o">.</span><span class="py">filter</span><span class="o">(</span><span class="nv">_</span><span class="o">.</span><span class="py">_1</span> <span class="o">!=</span> <span class="s">"userID"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">userArtistsIDS</span> <span class="k">=</span> <span class="nv">IndexedDatasetSpark</span><span class="o">.</span><span class="py">apply</span><span class="o">(</span><span class="n">userArtistsRDD</span><span class="o">)(</span><span class="n">sc</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">userFriendsRDD</span> <span class="k">=</span> <span class="nv">sc</span><span class="o">.</span><span class="py">textFile</span><span class="o">(</span><span class="s">"/path/to/lastfm/user_friends.dat"</span><span class="o">)</span>
                          <span class="o">.</span><span class="py">map</span><span class="o">(</span><span class="n">line</span> <span class="k">=&gt;</span> <span class="nv">line</span><span class="o">.</span><span class="py">split</span><span class="o">(</span><span class="s">"\t"</span><span class="o">))</span>
                          <span class="o">.</span><span class="py">map</span><span class="o">(</span><span class="n">a</span> <span class="k">=&gt;</span> <span class="o">(</span><span class="nf">a</span><span class="o">(</span><span class="mi">0</span><span class="o">),</span> <span class="nf">a</span><span class="o">(</span><span class="mi">1</span><span class="o">)))</span>
                          <span class="o">.</span><span class="py">filter</span><span class="o">(</span><span class="nv">_</span><span class="o">.</span><span class="py">_1</span> <span class="o">!=</span> <span class="s">"userID"</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">userFriendsIDS</span> <span class="k">=</span> <span class="nv">IndexedDatasetSpark</span><span class="o">.</span><span class="py">apply</span><span class="o">(</span><span class="n">userFriendsRDD</span><span class="o">)(</span><span class="n">sc</span><span class="o">)</span>
</code></pre></div></div>

<p>How much easier was that?! In each RDD creations we:</p>

<p>Load our data using sc.textFile</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sc.textFile("/path/to/lastfm/user_taggedartists.dat")
</code></pre></div></div>

<p>Split the data into an array based on tabs (\t)</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>.map(line =&gt; line.split("\t"))
</code></pre></div></div>

<p>Pull the userID column into the first position of the tuple, and the other attribute we want into the second position.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>.map(a =&gt; (a(0), a(1)))
</code></pre></div></div>

<p>Remove the header (the only line that will have “userID” in that position)</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>.filter(_._1 != "userID")
</code></pre></div></div>

<p>Then we easily create an IndexedDataSet using the <code class="language-plaintext highlighter-rouge">apply</code> method.
val userTagsIDS = IndexedDatasetSpark.apply(userTagsRDD)(sc)
Note the <code class="language-plaintext highlighter-rouge">(sc)</code> at the end. You may or may not need that.  <code class="language-plaintext highlighter-rouge">sc</code> is the SparkContext and should be passed as an implicit parameter, however the REPL environment (e.g. Mahout Shell or notebooks) has a hard time with the implicits, so I had to pass it explicitly.</p>

<p>Now we compute our co-occurrence matrices:</p>
<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">org.apache.mahout.math.cf.SimilarityAnalysis</span>

<span class="k">val</span> <span class="nv">artistReccosLlrDrmListByArtist</span> <span class="k">=</span> <span class="nv">SimilarityAnalysis</span><span class="o">.</span><span class="py">cooccurrencesIDSs</span><span class="o">(</span>
			<span class="nc">Array</span><span class="o">(</span><span class="n">userArtistsIDS</span><span class="o">,</span> <span class="n">userTagsIDS</span><span class="o">,</span> <span class="n">userFriendsIDS</span><span class="o">),</span>
						<span class="n">maxInterestingItemsPerThing</span> <span class="k">=</span> <span class="mi">20</span><span class="o">,</span>
						<span class="n">maxNumInteractions</span> <span class="k">=</span> <span class="mi">500</span><span class="o">,</span>
						<span class="n">randomSeed</span> <span class="k">=</span> <span class="mi">1234</span><span class="o">)</span>
</code></pre></div></div>

<p>Let’s see an example of how this would work-</p>

<p>First we have a small problem. If you look at our original input files, the userIDs, artistIDs, and tags were all integers. We loaded them as strings and if you look at the BiDictionaries associated with each IDS, you’ll see they map the original integers as strings to the integer indices of our matrix. Not super helpful.  There are other files which contain mappings from LastFM ID to human readable band and tag names.  I could have sorted this out in the begining but I chose to do it on the backside because it is a bit of clever Spark/Scala only needed to work around a quirk in this particular dataset.  We have to reverse map a few things if we want to input ‘human readable’ attributes, which I did.  If this doesn’t make sense, please don’t be discouraged- the important part was above, this is just some magic for working with this dataset in a pretty way.</p>

<p>First I load, and create incore maps from the mapping files:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">val</span> <span class="nv">artistMap</span> <span class="k">=</span> <span class="nv">sc</span><span class="o">.</span><span class="py">textFile</span><span class="o">(</span><span class="s">"/path/to/lastfm/artists.dat"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">map</span><span class="o">(</span><span class="n">line</span> <span class="k">=&gt;</span> <span class="nv">line</span><span class="o">.</span><span class="py">split</span><span class="o">(</span><span class="s">"\t"</span><span class="o">))</span>
  <span class="o">.</span><span class="py">map</span><span class="o">(</span><span class="n">a</span> <span class="k">=&gt;</span> <span class="o">(</span><span class="nf">a</span><span class="o">(</span><span class="mi">1</span><span class="o">),</span> <span class="nf">a</span><span class="o">(</span><span class="mi">0</span><span class="o">)))</span>
  <span class="o">.</span><span class="py">filter</span><span class="o">(</span><span class="nv">_</span><span class="o">.</span><span class="py">_1</span> <span class="o">!=</span> <span class="s">"name"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">collect</span>
  <span class="o">.</span><span class="py">toMap</span>

<span class="k">val</span> <span class="nv">tagsMap</span> <span class="k">=</span> <span class="nv">sc</span><span class="o">.</span><span class="py">textFile</span><span class="o">(</span><span class="s">"/path/tolastfm/tags.dat"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">map</span><span class="o">(</span><span class="n">line</span> <span class="k">=&gt;</span> <span class="nv">line</span><span class="o">.</span><span class="py">split</span><span class="o">(</span><span class="s">"\t"</span><span class="o">))</span>
  <span class="o">.</span><span class="py">map</span><span class="o">(</span><span class="n">a</span> <span class="k">=&gt;</span> <span class="o">(</span><span class="nf">a</span><span class="o">(</span><span class="mi">1</span><span class="o">),</span> <span class="nf">a</span><span class="o">(</span><span class="mi">0</span><span class="o">)))</span>
  <span class="o">.</span><span class="py">filter</span><span class="o">(</span><span class="nv">_</span><span class="o">.</span><span class="py">_1</span> <span class="o">!=</span> <span class="s">"tagValue"</span><span class="o">)</span>
  <span class="o">.</span><span class="py">collect</span>
  <span class="o">.</span><span class="py">toMap</span>

</code></pre></div></div>

<p>This will create some <code class="language-plaintext highlighter-rouge">Map</code>s that I can use to type readable names for the artist and tags to create my ‘history’.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">val</span> <span class="nv">kilroyUserArtists</span> <span class="k">=</span> <span class="nf">svec</span><span class="o">(</span> <span class="o">(</span><span class="nv">userArtistsIDS</span><span class="o">.</span><span class="py">columnIDs</span><span class="o">.</span><span class="py">get</span><span class="o">(</span><span class="nf">artistMap</span><span class="o">(</span><span class="s">"Beck"</span><span class="o">)).</span><span class="py">get</span><span class="o">,</span> <span class="mi">1</span><span class="o">)</span> <span class="o">::</span>
 <span class="o">(</span><span class="nv">userArtistsIDS</span><span class="o">.</span><span class="py">columnIDs</span><span class="o">.</span><span class="py">get</span><span class="o">(</span><span class="nf">artistMap</span><span class="o">(</span><span class="s">"David Bowie"</span><span class="o">)).</span><span class="py">get</span><span class="o">,</span> <span class="mi">1</span><span class="o">)</span> <span class="o">::</span>
 <span class="o">(</span><span class="nv">userArtistsIDS</span><span class="o">.</span><span class="py">columnIDs</span><span class="o">.</span><span class="py">get</span><span class="o">(</span><span class="nf">artistMap</span><span class="o">(</span><span class="s">"Gary Numan"</span><span class="o">)).</span><span class="py">get</span><span class="o">,</span> <span class="mi">1</span><span class="o">)</span> <span class="o">::</span>
 <span class="o">(</span><span class="nv">userArtistsIDS</span><span class="o">.</span><span class="py">columnIDs</span><span class="o">.</span><span class="py">get</span><span class="o">(</span><span class="nf">artistMap</span><span class="o">(</span><span class="s">"Less Than Jake"</span><span class="o">)).</span><span class="py">get</span><span class="o">,</span> <span class="mi">1</span><span class="o">)</span> <span class="o">::</span>
 <span class="o">(</span><span class="nv">userArtistsIDS</span><span class="o">.</span><span class="py">columnIDs</span><span class="o">.</span><span class="py">get</span><span class="o">(</span><span class="nf">artistMap</span><span class="o">(</span><span class="s">"Lou Reed"</span><span class="o">)).</span><span class="py">get</span><span class="o">,</span> <span class="mi">1</span><span class="o">)</span> <span class="o">::</span>
 <span class="o">(</span><span class="nv">userArtistsIDS</span><span class="o">.</span><span class="py">columnIDs</span><span class="o">.</span><span class="py">get</span><span class="o">(</span><span class="nf">artistMap</span><span class="o">(</span><span class="s">"Parliament"</span><span class="o">)).</span><span class="py">get</span><span class="o">,</span> <span class="mi">1</span><span class="o">)</span> <span class="o">::</span>
 <span class="o">(</span><span class="nv">userArtistsIDS</span><span class="o">.</span><span class="py">columnIDs</span><span class="o">.</span><span class="py">get</span><span class="o">(</span><span class="nf">artistMap</span><span class="o">(</span><span class="s">"Radiohead"</span><span class="o">)).</span><span class="py">get</span><span class="o">,</span> <span class="mi">1</span><span class="o">)</span> <span class="o">::</span>
 <span class="o">(</span><span class="nv">userArtistsIDS</span><span class="o">.</span><span class="py">columnIDs</span><span class="o">.</span><span class="py">get</span><span class="o">(</span><span class="nf">artistMap</span><span class="o">(</span><span class="s">"Seu Jorge"</span><span class="o">)).</span><span class="py">get</span><span class="o">,</span> <span class="mi">1</span><span class="o">)</span> <span class="o">::</span>
 <span class="o">(</span><span class="nv">userArtistsIDS</span><span class="o">.</span><span class="py">columnIDs</span><span class="o">.</span><span class="py">get</span><span class="o">(</span><span class="nf">artistMap</span><span class="o">(</span><span class="s">"The Skatalites"</span><span class="o">)).</span><span class="py">get</span><span class="o">,</span> <span class="mi">1</span><span class="o">)</span> <span class="o">::</span>
 <span class="o">(</span><span class="nv">userArtistsIDS</span><span class="o">.</span><span class="py">columnIDs</span><span class="o">.</span><span class="py">get</span><span class="o">(</span><span class="nf">artistMap</span><span class="o">(</span><span class="s">"Reverend Horton Heat"</span><span class="o">)).</span><span class="py">get</span><span class="o">,</span> <span class="mi">1</span><span class="o">)</span> <span class="o">::</span>
 <span class="o">(</span><span class="nv">userArtistsIDS</span><span class="o">.</span><span class="py">columnIDs</span><span class="o">.</span><span class="py">get</span><span class="o">(</span><span class="nf">artistMap</span><span class="o">(</span><span class="s">"Talking Heads"</span><span class="o">)).</span><span class="py">get</span><span class="o">,</span> <span class="mi">1</span><span class="o">)</span> <span class="o">::</span>
 <span class="o">(</span><span class="nv">userArtistsIDS</span><span class="o">.</span><span class="py">columnIDs</span><span class="o">.</span><span class="py">get</span><span class="o">(</span><span class="nf">artistMap</span><span class="o">(</span><span class="s">"Tom Waits"</span><span class="o">)).</span><span class="py">get</span><span class="o">,</span> <span class="mi">1</span><span class="o">)</span> <span class="o">::</span>
 <span class="o">(</span><span class="nv">userArtistsIDS</span><span class="o">.</span><span class="py">columnIDs</span><span class="o">.</span><span class="py">get</span><span class="o">(</span><span class="nf">artistMap</span><span class="o">(</span><span class="s">"Waylon Jennings"</span><span class="o">)).</span><span class="py">get</span><span class="o">,</span> <span class="mi">1</span><span class="o">)</span> <span class="o">::</span>
 <span class="o">(</span><span class="nv">userArtistsIDS</span><span class="o">.</span><span class="py">columnIDs</span><span class="o">.</span><span class="py">get</span><span class="o">(</span><span class="nf">artistMap</span><span class="o">(</span><span class="s">"Wu-Tang Clan"</span><span class="o">)).</span><span class="py">get</span><span class="o">,</span> <span class="mi">1</span><span class="o">)</span> <span class="o">::</span> <span class="nc">Nil</span><span class="o">,</span>
 <span class="n">cardinality</span> <span class="k">=</span> <span class="nv">userArtistsIDS</span><span class="o">.</span><span class="py">columnIDs</span><span class="o">.</span><span class="py">size</span>
<span class="o">)</span>



<span class="k">val</span> <span class="nv">kilroyUserTags</span> <span class="k">=</span> <span class="nf">svec</span><span class="o">(</span>
 <span class="o">(</span><span class="nv">userTagsIDS</span><span class="o">.</span><span class="py">columnIDs</span><span class="o">.</span><span class="py">get</span><span class="o">(</span><span class="nf">tagsMap</span><span class="o">(</span><span class="s">"classical"</span><span class="o">)).</span><span class="py">get</span><span class="o">,</span> <span class="mi">1</span><span class="o">)</span> <span class="o">::</span>
 <span class="o">(</span><span class="nv">userTagsIDS</span><span class="o">.</span><span class="py">columnIDs</span><span class="o">.</span><span class="py">get</span><span class="o">(</span><span class="nf">tagsMap</span><span class="o">(</span><span class="s">"skacore"</span><span class="o">)).</span><span class="py">get</span><span class="o">,</span> <span class="mi">1</span><span class="o">)</span> <span class="o">::</span>
 <span class="o">(</span><span class="nv">userTagsIDS</span><span class="o">.</span><span class="py">columnIDs</span><span class="o">.</span><span class="py">get</span><span class="o">(</span><span class="nf">tagsMap</span><span class="o">(</span><span class="s">"why on earth is this just a bonus track"</span><span class="o">)).</span><span class="py">get</span><span class="o">,</span> <span class="mi">1</span><span class="o">)</span> <span class="o">::</span>
 <span class="o">(</span><span class="nv">userTagsIDS</span><span class="o">.</span><span class="py">columnIDs</span><span class="o">.</span><span class="py">get</span><span class="o">(</span><span class="nf">tagsMap</span><span class="o">(</span><span class="s">"punk rock"</span><span class="o">)).</span><span class="py">get</span><span class="o">,</span> <span class="mi">1</span><span class="o">)</span> <span class="o">::</span> <span class="nc">Nil</span><span class="o">,</span>
 <span class="n">cardinality</span> <span class="k">=</span> <span class="nv">userTagsIDS</span><span class="o">.</span><span class="py">columnIDs</span><span class="o">.</span><span class="py">size</span><span class="o">)</span>
</code></pre></div></div>

<p>So what we have then is me typing in a name to <code class="language-plaintext highlighter-rouge">artistMap</code> where the keys are human readable names of my favorite bands, which returns the value which is the LastFM ID, which in turn is the key in the BiDictionary map, and returns the matrix position.  I’m making a sparse vector where I want the index at the value I just fetched (which in an awry way refers to the artist I specified) to have the value 1.</p>

<p>Same idea for the tags.</p>

<p>I now have two history vectors.  I didn’t make one for the users table, because I don’t have any friends on LastFM yet. That’s about to change though, because I’m about to have some friends recommended to me.</p>

<p>val kilroysRecs = (artistReccosLlrDrmListByArtist(0).matrix %<em>% kilroyUserArtists + artistReccosLlrDrmListByArtist(1).matrix %</em>% kilroyUserTags).collect
Finally let’s sort that vector out and get some user ids and strengths.</p>
<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">org.apache.mahout.math.scalabindings.MahoutCollections._</span>
<span class="k">import</span> <span class="nn">collection._</span>
<span class="k">import</span> <span class="nn">JavaConversions._</span>

<span class="c1">// Which Users I should Be Friends with.</span>
<span class="nf">println</span><span class="o">(</span><span class="nf">kilroysRecs</span><span class="o">(::,</span> <span class="mi">0</span><span class="o">).</span><span class="py">toMap</span><span class="o">.</span><span class="py">toList</span><span class="o">.</span><span class="py">sortWith</span><span class="o">(</span><span class="nv">_</span><span class="o">.</span><span class="py">_2</span> <span class="o">&gt;</span> <span class="nv">_</span><span class="o">.</span><span class="py">_2</span><span class="o">).</span><span class="py">take</span><span class="o">(</span><span class="mi">5</span><span class="o">))</span>

</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">kilroysRecs</code> is actually a one column matrix, so we take that, and the convert it into something we can sort. We then take the top 5 suggestions.  Keep in mind, this will return the Mahout user ID, which you would also have to reverse map back to the lastFM userID.  The lastFM userID is just another Integer, and not particularly exciting so I left that out.</p>

<p>If you wanted to recommend artists like a normal recommendation engine- you would change the first position in all of the input matrices to be “artistID”. This is left as an exercise to the user.</p>

<p><a href="cco-lastfm.scala">Full Scala Worksheet</a></p>

    </div>


  </div>

</div>


  <footer class="footer bg-light">
    <div class="container text-center small">
        Copyright &copy; 2014-2026 <a href="http://www.apache.org/">The Apache Software Foundation</a>, Licensed under the Apache License, Version 2.0.
    </div>
</footer>


  <script src="/assets/vendor/jquery/jquery-slim.min.js"></script>
  <script src="/assets/vendor/popper/popper.min.js"></script>
  <script src="/assets/vendor/bootstrap/js/bootstrap.min.js"></script>
  <script src="/assets/header.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>

</body>

</html>
