<!DOCTYPE html>
<html lang=" en ">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>
    Stochastic SVD
    
  </title>

  <meta name="description" content="Distributed Linear Algebra">

  <link rel="stylesheet" href="/assets/css/main.css">

  <!-- Font Awesome -->
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Maven+Pro:400,500" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Muli:400,400i,700,700i" rel="stylesheet">

  <link rel="canonical" href="http://mahout.apache.org//Map_Reduce_Folder/dim-reduction/ssvd.html">
  <link rel="alternate" type="application/rss+xml" title="Apache Mahout" href="/feed.xml">

  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS_HTML">
    MathJax.Hub.Config({
      "HTML-CSS": {
        availableFonts: ["TeX"],
      },
      tex2jax: {
        inlineMath: [['$','$'],["\\(","\\)"]]},
      displayMath: [ ['$$','$$'], ['\[','\]'] ],
      TeX: {
        extensions: ["AMSmath.js", "AMSsymbols.js", "color.js"],
        equationNumbers: {
          autoNumber: "AMS"
        }
      },
      showProcessingMessages: false,
      messageStyle: "none",
      imageFont: null,
      "AssistiveMML": { disabled: true }
    });
  </script>
</head>

<!-- Matomo -->
<script>
  var _paq = window._paq = window._paq || [];
  /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
  _paq.push(["setDoNotTrack", true]);
  _paq.push(["disableCookies"]);
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="https://analytics.apache.org/";
    _paq.push(['setTrackerUrl', u+'matomo.php']);
    _paq.push(['setSiteId', '70']);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
<!-- End Matomo Code -->

<body>

  <nav class="navbar navbar-expand-lg navbar-light bg-light navbar-mahout">

    <div class="container">

        <a class="navbar-brand" href="/">
          <img src="/assets/mahout-logo-blue.svg" alt="">
        </a>

        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarSupportedContent">

            <ul class="navbar-nav ml-auto">

                <!-- About -->
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle"
                       href="" id="navbarDropdownMenuLink-about"
                       data-toggle="dropdown"
                       aria-haspopup="true"
                       aria-expanded="false">About</a>
                    <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                        <a class="dropdown-item"
                           href="https://www.apache.org/foundation/how-it-works.html">Overview of the Apache Software Foundation</a>
                        <a class="dropdown-item"
                           href="/about/distributed-matrix-math.html">Overview of Distributed Matrix Math</a>
                        <a class="dropdown-item"
                           href="/about/how-to-contribute.html">How to Contribute</a>
                    </div>
                </li>

                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle"
                       href="" id="navbarDropdownMenuLink-qumat"
                       data-toggle="dropdown"
                       aria-haspopup="true"
                       aria-expanded="false">Qumat</a>
                    <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                        <a class="dropdown-item"
                           href="/quantum-computing-primer">Quantum Computing Primer</a>
<!--                        TODO: Add More QuMat stuff here or refactor the whole thing-->
                    </div>
                </li>
                <!-- Documentation -->
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle"
                       href="" id="navbarDropdownMenuLink-docs"
                       data-toggle="dropdown"
                       aria-haspopup="true"
                       aria-expanded="false">Documentation</a>
                    <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                        <a class="dropdown-item"
                           href="/papers.html">Papers</a>
                        <a class="dropdown-item"
                           href="/documentation/users">User Guide</a>
                        <a class="dropdown-item"
                           href="/documentation/developers">Developer Guide</a>
                        <a class="dropdown-item"
                           href="/docs/0.13.0/api/docs/">API Reference</a>
                        <a class="dropdown-item"
                           href="/documentation/tutorials">Tutorials and Examples</a>
                    </div>
                </li>

                <!-- Download -->
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle"
                       href="" id="navbarDropdownMenuLink-download"
                       data-toggle="dropdown"
                       aria-haspopup="true"
                       aria-expanded="false">Download</a>
                    <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                        <a class="dropdown-item"
                           href="/download/downloads.html">Latest Release</a>
                        <a class="dropdown-item"
                           href="https://github.com/apache/mahout/">Github Repository</a>
                    </div>
                </li>

                <!-- Community -->
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle"
                       href="" id="navbarDropdownMenuLink-community"
                       data-toggle="dropdown"
                       aria-haspopup="true"
                       aria-expanded="false">Community</a>
                    <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">

                        <a class="dropdown-item"
                           href="/community/">Overview</a>
                        <a class="dropdown-item"
                           href="/community/who-we-are.html">Who We Are</a>
                        <a class="dropdown-item"
                           href="/community/mailing-lists.html">Mailing Lists</a>
                        <a class="dropdown-item"
                           href="https://issues.apache.org/jira/browse/MAHOUT">Issue Tracker</a>
                        <a class="dropdown-item"
                           href="/documentation/developers/">Developer Documentation</a>
                        <a class="dropdown-item"
                           href="/community/coc.html">Code of Conduct</a>
                    </div>
                </li>

                <!-- News and Events -->
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle"
                       href="/news-and-events/news.html" id="navbarDropdownMenuLink-news-events"
                       aria-haspopup="true"
                       aria-expanded="false">Latest Project News</a>
                    <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                        <a class="dropdown-item"
                           href="/news-and-events/news.html">Latest Project News</a>
                    </div>
                </li>


                <!-- GitHub -->
                <li class="nav-item">
                    <a class="nav-link" href="http://github.com/apache/mahout"><i class="fa fa-github"></i></a>
                </li>

            </ul>

            <!-- <form class="form-inline my-2 my-lg-0">
            <input class="form-control mr-sm-2" type="text" placeholder="Search" aria-label="Search">
            <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
        </form> -->

        </div>

    </div>

</nav>


  <h1 id="stochastic-singular-value-decomposition">Stochastic Singular Value Decomposition</h1>

<p>Stochastic SVD method in Mahout produces reduced rank Singular Value Decomposition output in its
strict mathematical definition: ` (\mathbf{A\approx U}\boldsymbol{\Sigma}\mathbf{V}^{\top})`.</p>

<p>##The benefits over other methods are:</p>

<ul>
  <li>
    <p>reduced flops required compared to Krylov subspace methods</p>
  </li>
  <li>
    <p>In map-reduce world, a fixed number of MR iterations required regardless of rank requested</p>
  </li>
  <li>
    <p>Tweak precision/speed balance with options.</p>
  </li>
  <li>
    <p>A is a Distributed Row Matrix where rows may be identified by any Writable (such as a document path). As such, it would work directly on the output of seq2sparse.</p>
  </li>
  <li>
    <p>As of 0.7 trunk, includes PCA and dimensionality reduction workflow (EXPERIMENTAL! Feedback on performance/other PCA related issues/ blogs is greatly appreciated.)</p>
  </li>
</ul>

<h3 id="map-reduce-characteristics">Map-Reduce characteristics:</h3>
<p>SSVD uses at most 3 MR sequential steps (map-only + map-reduce + 2 optional parallel map-reduce jobs) to produce reduced rank approximation of U, V and S matrices. Additionally, two more map-reduce steps are added for each power iteration step if requested.</p>

<p>##Potential drawbacks:</p>

<p>potentially less precise (but adding even one power iteration seems to fix that quite a bit).</p>

<p>##Documentation</p>

<p><a href="ssvd.page/SSVD-CLI.pdf">Overview and Usage</a></p>

<p>Note: Please use 0.6 or later! for PCA workflow, please use 0.7 or later.</p>

<p>##Publications</p>

<p><a href="http://amath.colorado.edu/faculty/martinss/Pubs/2012_halko_dissertation.pdf">Nathan Halko’s dissertation</a> “Randomized methods for computing low-rank
approximations of matrices” contains comprehensive definition of parallelization strategy taken in Mahout SSVD implementation and also some precision/scalability benchmarks, esp. w.r.t. Mahout Lanczos implementation on a typical corpus data set.</p>

<p><a href="http://arxiv.org/abs/0909.4061">Halko, Martinsson, Tropp</a> paper discusses family of random projection-based algorithms and contains theoretical error estimates.</p>

<p><strong>R simulation</strong></p>

<p><a href="ssvd.page/ssvd.R">Non-parallel SSVD simulation in R</a> with power iterations and PCA options. Note that this implementation is not most optimal for sequential flow solver, but it is for demonstration purposes only.</p>

<p>However, try this R code to simulate a meaningful input:</p>

<p><strong>tests.R</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>n&lt;-1000
m&lt;-2000
k&lt;-10

qi&lt;-1

#simulated input
svalsim&lt;-diag(k:1)

usim&lt;- qr.Q(qr(matrix(rnorm(m*k, mean=3), nrow=m,ncol=k)))
vsim&lt;- qr.Q(qr( matrix(rnorm(n*k,mean=5), nrow=n,ncol=k)))


x&lt;- usim %*% svalsim %*% t(vsim)
</code></pre></div></div>

<p>and try to compare ssvd.svd(x) and stock svd(x) performance for the same rank k, notice the difference in the running time. Also play with power iterations (qIter) and compare accuracies of standard svd and SSVD.</p>

<p>Note: numerical stability of R algorithms may differ from that of Mahout’s distributed version. We haven’t studied accuracy of the R simulation. For study of accuracy of Mahout’s version, please refer to Nathan’s dissertation as referenced above.</p>

<h4 id="modified-ssvd-algorithm">Modified SSVD Algorithm.</h4>

<p>Given an <code class="language-plaintext highlighter-rouge">\(m\times n\)</code>
matrix <code class="language-plaintext highlighter-rouge">\(\mathbf{A}\)</code>, a target rank <code class="language-plaintext highlighter-rouge">\(k\in\mathbb{N}_{1}\)</code>
, an oversampling parameter <code class="language-plaintext highlighter-rouge">\(p\in\mathbb{N}_{1}\)</code>,
and the number of additional power iterations <code class="language-plaintext highlighter-rouge">\(q\in\mathbb{N}_{0}\)</code>,
this procedure computes an <code class="language-plaintext highlighter-rouge">\(m\times\left(k+p\right)\)</code>
SVD <code class="language-plaintext highlighter-rouge">\(\mathbf{A\approx U}\boldsymbol{\Sigma}\mathbf{V}^{\top}\)</code>:</p>

<ol>
  <li>
    <p>Create seed for random <code class="language-plaintext highlighter-rouge">\(n\times\left(k+p\right)\)</code>
  matrix <code class="language-plaintext highlighter-rouge">\(\boldsymbol{\Omega}\)</code>. The seed defines matrix <code class="language-plaintext highlighter-rouge">\(\mathbf{\Omega}\)</code>
  using Gaussian unit vectors per one of suggestions in <a href="http://arxiv.org/abs/0909.4061">Halko, Martinsson, Tropp</a>.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">\(\mathbf{Y=A\boldsymbol{\Omega}},\,\mathbf{Y}\in\mathbb{R}^{m\times\left(k+p\right)}\)</code></p>
  </li>
  <li>
    <p>Column-orthonormalize <code class="language-plaintext highlighter-rouge">\(\mathbf{Y}\rightarrow\mathbf{Q}\)</code>
  by computing thin decomposition <code class="language-plaintext highlighter-rouge">\(\mathbf{Y}=\mathbf{Q}\mathbf{R}\)</code>.
  Also, <code class="language-plaintext highlighter-rouge">\(\mathbf{Q}\in\mathbb{R}^{m\times\left(k+p\right)},\,\mathbf{R}\in\mathbb{R}^{\left(k+p\right)\times\left(k+p\right)}\)</code>.
  I denote this as <code class="language-plaintext highlighter-rouge">\(\mathbf{Q}=\mbox{qr}\left(\mathbf{Y}\right).\mathbf{Q}\)</code></p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">\(\mathbf{B}_{0}=\mathbf{Q}^{\top}\mathbf{A}:\,\,\mathbf{B}\in\mathbb{R}^{\left(k+p\right)\times n}\)</code>.</p>
  </li>
  <li>
    <p>If <code class="language-plaintext highlighter-rouge">\(q&gt;0\)</code>
  repeat: for <code class="language-plaintext highlighter-rouge">\(i=1..q\)</code>:
  <code class="language-plaintext highlighter-rouge">\(\mathbf{B}_{i}^{\top}=\mathbf{A}^{\top}\mbox{qr}\left(\mathbf{A}\mathbf{B}_{i-1}^{\top}\right).\mathbf{Q}\)</code>
  (power iterations step).</p>
  </li>
  <li>
    <p>Compute Eigensolution of a small Hermitian <code class="language-plaintext highlighter-rouge">\(\mathbf{B}_{q}\mathbf{B}_{q}^{\top}=\mathbf{\hat{U}}\boldsymbol{\Lambda}\mathbf{\hat{U}}^{\top}\)</code>,
  <code class="language-plaintext highlighter-rouge">\(\mathbf{B}_{q}\mathbf{B}_{q}^{\top}\in\mathbb{R}^{\left(k+p\right)\times\left(k+p\right)}\)</code>.</p>
  </li>
  <li>
    <p>Singular values <code class="language-plaintext highlighter-rouge">\(\mathbf{\boldsymbol{\Sigma}}=\boldsymbol{\Lambda}^{0.5}\)</code>,
  or, in other words, <code class="language-plaintext highlighter-rouge">\(s_{i}=\sqrt{\sigma_{i}}\)</code>.</p>
  </li>
  <li>
    <p>If needed, compute <code class="language-plaintext highlighter-rouge">\(\mathbf{U}=\mathbf{Q}\hat{\mathbf{U}}\)</code>.</p>
  </li>
  <li>
    <p>If needed, compute <code class="language-plaintext highlighter-rouge">\(\mathbf{V}=\mathbf{B}_{q}^{\top}\hat{\mathbf{U}}\boldsymbol{\Sigma}^{-1}\)</code>.
Another way is <code class="language-plaintext highlighter-rouge">\(\mathbf{V}=\mathbf{A}^{\top}\mathbf{U}\boldsymbol{\Sigma}^{-1}\)</code>.</p>
  </li>
</ol>


  <footer class="footer bg-light">
    <div class="container text-center small">
        Copyright &copy; 2014-2026 <a href="http://www.apache.org/">The Apache Software Foundation</a>, Licensed under the Apache License, Version 2.0.
    </div>
</footer>

  <script src="/assets/vendor/jquery/jquery-slim.min.js"></script>
  <script src="/assets/vendor/popper/popper.min.js"></script>
  <script src="/assets/vendor/bootstrap/js/bootstrap.min.js"></script>
  <script src="/assets/header.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>
</body>
</html>
